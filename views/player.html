<%-  include("include/header.ejs") -%>
  <main id="main" class="main">
    <div class="pagetitle">
      <h1>Data Tables</h1>
      
    </div><!-- End Page Title -->
    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
  <!-- Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <!-- Custom JS -->
  <div class="col-lg-12" style="padding: 10px 0px;">
    <input type="text"   class="form-control" id="searchInput"  placeholder="Search by Name, Mobile, Email...">
  </div>

    <button id="downloadExcel" class="btn btn-success mb-3">
      <i class="fas fa-file-excel"></i> Print as Excel
    </button>
    <button id="downloadPDF" class="btn btn-danger mb-3">
      <i class="fas fa-file-pdf"></i> Download as PDF
    </button>
   
    <section class="section" id="userTable">
      <div class="row">
        <div class="col-lg-12">

          <div class="card">
            <div class="card-body">
              <!-- Table with stripped rows -->
              <table class="table datatable" id="userDataTable">
                <thead>
                  <tr>
                    <th scope="col">Sr.No</th>
                    <th scope="col">Name</th>
                    <th scope="col">Mobile</th>
                    <th scope="col">Email</th>
                    <th scope="col">Loan Type</th>
                    <th scope="col">Address</th>
                    <th scope="col">Action</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (profile.length === 0) { %>
                    <tr>
                      <td colspan="6" style="text-align: center;">No users found</td>
                    </tr>
                  <% } else { %>
                    <% profile.forEach((user, index) => { %>
                      <tr>
                        <td><%= index + 1 %></td>
                        <td class="name"><%= user.Username %></td>
                        <td class="mobile"><%= user.phoneNumber %></td>
                        <td class="email"><%= user.email %></td>
                        <td class="email"><%= user.loanType %></td>
                        <td><%= user.address %></td>
                        <td>
                         
                          <button class="btn btn-danger delete-btn" data-toggle="modal" data-target="#deleteModal"  data-id="<%= user._id %>">
                            <i class="fas fa-trash-alt"></i>
                          </button>
                          <button class="btn btn-primary edit-btn" data-toggle="modal" data-target="#editModal">
                            <a href="/back/user/<%= user._id %>" style="color: white;">
                              <i class="fas fa-eye"></i>
                            </a>
                          </button>
                        </td>
                      </tr>
                    <% }); %>
                  <% } %>
                </tbody>
              </table>
              
            </div>
          </div>

        </div>
      </div>
    </section>
<!-- deltet modal -->
<div class="text-center">
  <!-- Button HTML (to Trigger Modal) -->
  <!-- <a >Click to Open Confirm Modal</a> -->
</div>

<!-- Modal HTML -->
<div id="deleteModal" class="modal fade">
  <div class="modal-dialog modal-confirm">
    <div class="modal-content">
      <div class="modal-header">
        <div class="d-flex align-items-center">
          <i class="bi bi-exclamation-circle text-danger" style="font-size: 2rem; margin-right: 10px;"></i>
          <h4 class="modal-title">Are you sure?</h4>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body text-center">
        <p>Do you really want to delete these records? This process cannot be undone.</p>
      </div>
      <div class="modal-footer justify-content-center">
        <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger">Delete</button>
      </div>
    </div>
  </div>
</div>

<!-- deltet modal -->



<!-- START Modal ADD LOBBIES -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Lobbies</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="">
          <div class="mb-3">
            <!-- <label for="formGroupExampleInput" class="form-label">Bot</label> -->
            <input type="text" class="form-control" id="formGroupExampleInput" placeholder="Bot">
          </div>
          <div class="mb-3">
            <!-- <label for="formGroupExampleInput2" class="form-label">Min Entry</label> -->
            <input type="text" class="form-control" id="formGroupExampleInput2" placeholder="Min Entry">
          </div>
          <button class="btn btn-success">Save</button>
       </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>
<!--end Modal ADD LOBBIES -->

<!-- START Modal edit LOBBIES -->
<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Lobbies</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="">
          <div class="mb-3">
            <!-- <label for="formGroupExampleInput" class="form-label">Bot</label> -->
            <input type="text" class="form-control" id="formGroupExampleInput" placeholder="Bot">
          </div>
          <div class="mb-3">
            <label for="formGroupExampleInput2" class="form-label">Min Entry</label>
            <input type="text" class="form-control" id="formGroupExampleInput2" placeholder="Min Entry">
          </div>
          <button class="btn btn-success">Save</button>
       </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>
<!--end Modal edit LOBBIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  document.getElementById('downloadPDF').addEventListener('click', function () {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    // Capture the table content as an image using html2canvas
    html2canvas(document.getElementById('userTable')).then((canvas) => {
      const imgData = canvas.toDataURL('image/png');
      const imgProps = doc.getImageProperties(imgData);
      const pdfWidth = doc.internal.pageSize.getWidth();
      const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

      doc.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
      doc.save('UserDetails.pdf');
    });
  });
  document.addEventListener('DOMContentLoaded', function() {
  // Search functionality
  document.getElementById('searchInput').addEventListener('keyup', function() {
    var value = this.value.toLowerCase();
    var rows = document.querySelectorAll('#userDataTable tbody tr');

    rows.forEach(function(row) {
      var name = row.querySelector('.name').textContent.toLowerCase();
      var mobile = row.querySelector('.mobile').textContent.toLowerCase();
      var email = row.querySelector('.email').textContent.toLowerCase();

      if (name.includes(value) || mobile.includes(value) || email.includes(value)) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  });
});


</script>

<script>
  document.getElementById('downloadExcel').addEventListener('click', function () {
    // alert("hi")
    var wb = XLSX.utils.table_to_book(document.getElementById('userTable'), { sheet: "Sheet JS" });
    XLSX.writeFile(wb, 'UserDetails.xlsx');
  });


  document.addEventListener('DOMContentLoaded', () => {
  let deleteUserId = null;

  // When delete button is clicked, store the user ID
  document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', function () {
      deleteUserId = this.getAttribute('data-id');
    });
  });

  // When confirm delete button in the modal is clicked
  document.querySelector('#deleteModal .btn-danger').addEventListener('click', async function () {
    if (deleteUserId) {
      // alert(deleteUserId)
      try {
        const response = await fetch(`http://localhost:7000/back/deleteuser/${deleteUserId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json',
          },
        });

        if (response.ok) {
          // alert('User deleted successfully');
          // Optionally, remove the user from the UI or refresh the page
          location.reload(); // Reload the page to update the list
        } else {
          alert('Failed to delete user');
        }
      } catch (error) {
        console.error('Error deleting user:', error);
        alert('An error occurred while deleting the user');
      }
    }
  });
});

</script>


  </main><!-- End #main -->
  <!-- <script src="assets/js/main.js"></script> -->
  
<%- include("include/footer.ejs") -%>